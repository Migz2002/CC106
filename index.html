<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Notepad</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
        }
        textarea {
            width: 100%;
            height: 300px;
            margin-top: 10px;
        }
        input, button {
            margin-top: 10px;
            padding: 8px;
        }
        #status {
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<h2>Notepad</h2>

<label>File name:</label><br>
<input type="text" id="filename" placeholder="example.txt"><br>

<textarea id="editor" placeholder="Write your text here..."></textarea><br>

<button onclick="loadFile()">Load File</button>
<button onclick="saveFile()">Save File</button>
<button onclick="clearText()">Clear Text</button>

<div id="status"></div>

<script>

const OWNER = "Makku-kun";
const REPO = "Cloud-Notepad-Storage";
const FOLDER = "files";
const BRANCH = "main";
// IMPORTANT: Do NOT commit a personal access token to source control.
// Set your GitHub Personal Access Token here (or better: inject at runtime).
const TOKEN = ""; // e.g. "ghp_..." ‚Äî keep this secret and do not commit


const statusEl = document.getElementById("status");

// Quick visual hint when no token is set (helps avoid confusion during testing)
if (!TOKEN) {
    statusEl.textContent = "‚ö†Ô∏è No GitHub token configured ‚Äî load/save disabled. Set TOKEN in the source for testing.";
    statusEl.style.color = "orange";
}
let currentFileSha = null;


async function loadFile() {
    const filename = document.getElementById("filename").value.trim();
    if (!filename) return setStatus("‚ùå File name required", "red");

    const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FOLDER}/${filename}?ref=${BRANCH}`;

    try {
        const res = await fetch(url, {
            headers: {
                Authorization: `Bearer ${TOKEN}`,
                Accept: "application/vnd.github.v3+json"
            }
        });

        if (!res.ok) throw new Error("File not found");

        const data = await res.json();
        // remove newlines and decode base64 -> UTF-8
        const base64 = (data.content || "").replace(/\n/g, "");
        const content = decodeURIComponent(escape(atob(base64)));

        document.getElementById("editor").value = content;
        currentFileSha = data.sha;

        setStatus("‚úÖ File loaded successfully", "green");
    } catch (err) {
        currentFileSha = null;
        setStatus("‚ö†Ô∏è Failed to load file", "red");
    }
}


async function saveFile() {
    const filename = document.getElementById("filename").value.trim();
    const text = document.getElementById("editor").value;

    if (!filename) return setStatus("‚ùå File name required", "red");

    const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FOLDER}/${filename}`;
    const encodedContent = btoa(unescape(encodeURIComponent(text)));

    const payload = {
        message: `Save ${filename}`,
        content: encodedContent,
        branch: BRANCH
    };

    if (currentFileSha) payload.sha = currentFileSha;

    try {
        const res = await fetch(url, {
            method: "PUT",
            headers: {
                Authorization: `Bearer ${TOKEN}`,
                Accept: "application/vnd.github.v3+json",
                "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
        });

        if (!res.ok) {
            const errText = await res.text();
            throw new Error("Save failed: " + errText);
        }

        const data = await res.json();
        currentFileSha = data.content.sha;

        setStatus("üíæ File saved successfully", "green");
    } catch (err) {
        setStatus("‚ùå Failed to save file", "red");
    }
}


function clearText() {
    document.getElementById("editor").value = "";
    currentFileSha = null;
    setStatus("üßπ Editor cleared", "gray");
}


function setStatus(msg, color) {
    statusEl.textContent = msg;
    statusEl.style.color = color;
}
</script>

</body>
</html>